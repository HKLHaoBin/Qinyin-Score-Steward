# 千音雅集 (Repertoire of Myriad Melodies)

千音雅集是一个用于管理原神风花节竖琴乐谱的 Flask Web 应用程序。它提供了剪贴板监控、完成率跟踪、收藏管理、批量查询、乐谱提取和随机池管理等功能，帮助玩家更好地管理和练习游戏中的音乐曲谱。

## 主要功能

### 1. 剪贴板监控
- 自动检测并显示来自剪贴板的乐谱码
- 实时显示当前游玩曲目的状态和完成率
- 支持快速保存完成率和收藏曲目

### 2. 完成率跟踪
- 记录每个乐谱的 0-100% 完成率
- 自动保存功能，输入完成率后自动更新
- 历史记录查看和管理

### 3. 收藏管理
- 标记/取消标记乐谱为收藏
- 收藏筛选功能，便于快速找到喜欢的曲目

### 4. 批量查询
- 支持批量导入乐谱码进行查询
- 提供排除功能，可排除已有的乐谱
- 支持按完成率和收藏状态进行筛选

### 5. 乐谱提取
- 自动从米游社网站提取最新的鉴赏谱
- 一键获取最新发布的乐谱码

### 6. 随机池管理
- 创建自定义随机池，用于随机选择练习曲目
- 支持按筛选条件创建池或自定义池内容
- 随机抽取功能，帮助玩家随机选择练习曲目

## 安装和运行

### 环境要求
- Python 3.7+
- Chrome 浏览器（用于乐谱提取功能）
- Windows 操作系统（推荐）

### 安装步骤

1. 克隆或下载本项目到本地
2. 安装依赖包：
   ```
   pip install -r requirements.txt
   ```

### 运行方式

#### 方式一：使用 Python 运行
```
python app.py
```
应用将在 `http://localhost:6605` 启动。

#### 方式二：使用打包的可执行文件
直接运行 `app.exe` 文件。

## 使用指南

### 主页功能
1. 打开应用后，主页会自动监控剪贴板中的乐谱码
2. 当检测到乐谱码时，会显示在"当前状态"区域
3. 可以输入 0-100 的完成率并保存
4. 点击"☆"按钮可收藏/取消收藏当前曲目
5. 历史记录会显示所有已记录的乐谱信息

### 批量查询功能
1. 点击导航栏的"批量查询"进入批量查询页面
2. 在输入框中粘贴包含乐谱码的文本
3. 点击"查询"按钮查看结果
4. 使用"排除"功能可排除输入框中的乐谱码
5. 可使用筛选功能按完成率或收藏状态过滤结果
6. 点击"随机复制"可随机选择一个乐谱码并复制到剪贴板

### 随机池管理
1. 点击导航栏的"随机池"进入随机池管理页面
2. 在"创建新随机池"区域设置筛选条件或自定义内容
3. 点击"创建池"按钮创建新的随机池
4. 在池列表中可以查看池中的乐谱信息
5. 支持对池进行二次筛选、随机抽取、删除等操作

### 鉴赏谱获取
1. 在批量查询页面，点击"获取鉴赏谱"按钮
2. 程序会自动从米游社网站提取最新的鉴赏谱
3. 提取成功后按钮会变为"新鉴赏码"，点击可获取最新的乐谱码

## 技术栈

- **后端**：Flask + Flask-SocketIO
- **前端**：HTML + CSS + JavaScript + Socket.IO
- **数据库**：SQLite
- **自动化**：Selenium + WebDriver Manager
- **其他**：Pyperclip（剪贴板操作）

## 注意事项

1. 应用默认使用 6605 端口，请确保该端口未被占用
2. 乐谱提取功能需要 Chrome 浏览器支持
3. 应用会自动备份数据库到 `backups/` 目录
4. 支持深色/浅色主题切换，会根据系统设置自动适配
5. 应用支持移动端访问，具有响应式设计

## 数据管理

- 乐谱数据存储在 `scores.db` SQLite 数据库中
- 旧的乐谱码会保存在 `The old appreciation code/` 目录中
- 数据库会自动备份，备份文件位于 `backups/` 目录