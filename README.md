# 千音雅集

一个用于管理原神风物之诗琴曲谱的工具，支持曲谱码管理、完成率记录和批量查询功能。

## 功能特点

- 🎵 自动监控剪贴板，实时显示曲谱码
- 📱 移动端友好，支持手机浏览器访问
- 📊 记录曲谱完成率
- ⭐ 支持收藏喜欢的曲谱
- 🔍 批量查询功能，支持批量排除曲谱码，排除逻辑在后端高效处理
- 🎲 随机复制表格中曲谱码
- 📈 实时数据同步
- 🔗 快速访问鉴赏家精选投稿
- 🎯 一键获取鉴赏谱
- 🔄 自动滚动加载
- 💾 智能数据备份
- 🆕 新鉴赏码功能，自动将昨日鉴赏曲谱码添加到排除列表

## 安装说明

## 方法一：使用打包好的exe (Windows)

1. 下载打包好exe的ZIP文件：

# >[点击蓝链前往下载](https://github.com/HKLHaoBin/Repertoire-of-Myriad-Melodies-Score-Tool/releases/tag/v2.6)<

2. 运行其中的exe文件：
- 在 `dist` 目录下找到 `千音雅集.exe`
- 双击运行即可

### 注意:可执行文件版本一般会落后于源码运行版本。

## 方法二：源码运行 (Windows/Mac/Linux)

### 我默认选择这个方法的各位有Python环境，没有Python环境的各位请选择方法1。

1. 使用Vscode类似的IDE,打开我的项目: 打开IDE ➡️ 选择左上角的文件 ➡️ 选择打开文件夹 
➡️ 选择刚刚下载，并解压好后的千音雅集（注意这一步 很多人会出错，需要不断点击文件夹 直到能看到templates、static文件夹，然后点击窗口右下角的"选择（当前）文件夹"）。

###当这一步完成后 能够在IDE中看到我的源码，可以开始第二步安装依赖了。
（当然，你可以在我的源码中扩展更多的功能，如果你愿意提供代码让这个项目变得更好，欢迎提issue，或者联系我！）

2. 安装依赖：

首先左上角打开**查看**菜单，选择**终端**。然后运行下面的命令：
```bash
pip install -r requirements.txt
```
（一般来说 Python3.9以上就自带pip了，而且能够安装进服务器中，非常的稳定。我的建议是使用9～12，不要使用更高或者更低的版本。）

3. 运行程序：
```bash
py app.py
```
（如果报错的话，将IDE以管理员身份运行，再打开我的项目文件夹，再重复安装依赖步骤，如果还是没有解决 可以提issue，或者干脆使用方法一。）

## 使用说明

### 运行服务

运行后，程序会自动复制访问地址到剪贴板。
建议与"微信输入法"的剪贴板同步功能配合使用！

### 使用建议

1. **电脑端（与手机处于统一局域网下）**：
   - 运行程序后，使用手机浏览器访问显示的地址
   - 在电脑上复制曲谱码，手机端会自动显示
   - 使用批量查询功能查找未完成的曲谱
   - 使用"获取鉴赏谱"功能快速获取鉴赏家精选曲谱
   - 使用"新鉴赏码"功能自动将昨日鉴赏曲谱码添加到排除列表

2. **手机端（与电脑处于统一局域网下）**：
   - 访问程序提供的地址
   - 在主页录入完成率
   - 查看历史记录
   - 收藏喜欢的曲谱
   - 使用批量查询功能

### 主要功能

1. **主页功能**：
   - 自动显示剪贴板中的曲谱码
   - 录入完成率（0-100）
   - 收藏/取消收藏曲谱
   - 查看历史记录

2. **批量查询功能**：
   - 支持批量输入曲谱码
   - 支持批量排除曲谱码（可一次性排除数百条，后端高效处理）
   - 显示完成率和收藏状态
   - 支持筛选未完成的曲谱
   - 实时更新完成率
   - 一键获取鉴赏谱
   - **新鉴赏码功能**：获取鉴赏谱后，按钮自动变为"新鉴赏码"，点击可将最新鉴赏曲谱码自动添加到排除列表并触发查询
   - 自动滚动加载所有曲谱
   - 随机复制表格中曲谱码

3. **数据同步**：
   - 主页录入的完成率会实时同步到批量查询页面
   - 收藏状态实时同步
   - 自动备份数据库

4. **随机池功能**：
   - 支持自定义筛选条件或曲谱码创建可命名的随机池，池内曲谱码可随机抽取且抽到后自动移除
   - 支持多个随机池独立管理，每个池可单独筛选、重置、删除、随机抽取
   - 池内容支持二次筛选、批量查询、批量排除，所有操作即时反馈
   - 池内容可随时重置为最初全量，避免误操作丢失
   - 池内曲谱码以表格展示，显示完成率、收藏状态，支持表头快捷筛选
   - 随机抽取后以卡片形式展示结果，并可直接编辑完成率/收藏
   - 支持从批量查询页一键跳转并预填筛选条件/曲谱码，体验流畅
   - 全新UI风格，支持移动端适配，所有操作均有toast提示

## 技术特点

- 使用 Flask 和 Socket.IO 实现实时通信
- SQLite 数据库存储
- 自动数据库备份
- 响应式设计，支持移动端
- 支持打包为独立exe文件
- Selenium 自动化爬取
- 智能滚动加载

## 注意事项

1. 确保电脑和手机在同一个局域网内
2. 程序默认使用 5005 端口
3. 数据库文件会自动备份到 backups 目录
4. 曲谱码必须至少为 5 位数字
5. 使用exe版本时，程序会在同目录下创建数据库和备份文件
6. 获取鉴赏谱功能需要安装 Chrome 浏览器

## 更新日志

### v2.6.0
- 批量查询功能支持"全量+排除"模式：
  - 只填写"排除"文本框即可全量排除指定曲谱码
  - "曲谱码"与"排除"可任意组合，查询更灵活
- 优化前端批量查询逻辑，体验更直观
- 后端 `/api/scores/batch` 支持无曲谱码时自动全量查询
- 修复部分情况下排除无效的问题
- 默认自动初始化 Chrome 浏览器，提升一键获取鉴赏谱的稳定性
- 代码结构优化，提升可维护性
- **新增"新鉴赏码"功能**：获取鉴赏谱后，按钮自动变为"新鉴赏码"，点击可将最新鉴赏曲谱码自动添加到排除列表并触发查询

### v1.1.0
- 添加一键获取鉴赏谱功能
- 优化批量查询界面
- 改进按钮样式
- 添加自动滚动加载
- 优化爬取性能

### v1.0.0
- 基础功能实现
- 支持曲谱码监控
- 完成率记录
- 收藏功能
- 批量查询
- 实时数据同步
- 移动端适配
- 支持打包为exe


